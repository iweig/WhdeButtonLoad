<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Whdebuttonload by whde</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Whdebuttonload</h1>
      <h2 class="project-tagline">UIButton 添加 Loading</h2>
      <a href="https://github.com/whde/WhdeButtonLoad" class="btn">View on GitHub</a>
      <a href="https://github.com/whde/WhdeButtonLoad/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/whde/WhdeButtonLoad/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h2>
<a id="whdebuttonload" class="anchor" href="#whdebuttonload" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>WhdeButtonLoad</h2>

<ul>
<li>当程序在点击UIButton之后请求网络数据，请求网络需要时间，在这个时间里，我们需要做到更极致的用户体验;</li>
<li>使用<code><strong>WhdeButtonLoad</strong></code>将会在这时间里会在Button上显示LoadingView，在完成之后，会恢复原状态;</li>
</ul>

<p><img src="https://raw.githubusercontent.com/whde/WhdeButtonLoad/master/Screen.gif" alt=""></p>

<div class="highlight highlight-source-objc"><pre>pod <span class="pl-s"><span class="pl-pds">'</span>WhdeButtonLoad<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>~&gt; 1.0.0<span class="pl-pds">'</span></span></pre></div>

<div class="highlight highlight-source-objc"><pre>#<span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">&lt;</span>WhdeButtonLoad/WhdeButtonLoad.h<span class="pl-pds">&gt;</span></span></pre></div>

<p>或者</p>

<div class="highlight highlight-source-objc"><pre>#<span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">"</span>UIButtonLoad.h<span class="pl-pds">"</span></span></pre></div>

<div class="highlight highlight-source-objc"><pre>UIButtonLoad *btn = [UIButtonLoad <span class="pl-c1">buttonWithType:</span>UIButtonTypeCustom];
[btn <span class="pl-c1">addAction:</span>^(UIButtonLoad *btn) {
    <span class="pl-c1">NSLog</span>(<span class="pl-s"><span class="pl-pds">@"</span>start<span class="pl-pds">"</span></span>);
    <span class="pl-c">// 伪装网络加载所需要的时间</span>
    __block <span class="pl-k">int</span> timeout= <span class="pl-c1">2</span>;
    __block UIButtonLoad *wsendCodeBtn = btn;
    <span class="pl-c1">dispatch_queue_t</span> queue = <span class="pl-c1">dispatch_get_global_queue</span>(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="pl-c1">0</span>);
    <span class="pl-c1">dispatch_source_t</span> timer = <span class="pl-c1">dispatch_source_create</span>(DISPATCH_SOURCE_TYPE_TIMER, <span class="pl-c1">0</span>, <span class="pl-c1">0</span>,queue);
    <span class="pl-c1">dispatch_source_set_timer</span>(timer,<span class="pl-c1">dispatch_walltime</span>(<span class="pl-c1">NULL</span>, <span class="pl-c1">0</span>),<span class="pl-c1">1.0</span>*NSEC_PER_SEC, <span class="pl-c1">0</span>);
    <span class="pl-c1">dispatch_source_set_event_handler</span>(timer, ^{
        <span class="pl-k">if</span>(timeout&lt; <span class="pl-c1">0</span>){
            <span class="pl-c1">dispatch_source_cancel</span>(timer);
            <span class="pl-c">// 网络请求完成，还原初始状态</span>
            [wsendCodeBtn <span class="pl-c1">finished</span>];
            <span class="pl-c1">NSLog</span>(<span class="pl-s"><span class="pl-pds">@"</span>finished<span class="pl-pds">"</span></span>);
        } <span class="pl-k">else</span> {
            <span class="pl-c1">NSLog</span>(<span class="pl-s"><span class="pl-pds">@"</span><span class="pl-c1">%d</span><span class="pl-pds">"</span></span>, timeout);
            timeout--;
        }
    });
    <span class="pl-c1">dispatch_resume</span>(timer);
    <span class="pl-c">// 伪装网络加载时间</span>

}];
[btn <span class="pl-c1">setBackgroundImage:</span>[UIImage <span class="pl-c1">imageNamed:</span><span class="pl-s"><span class="pl-pds">@"</span>29pt@3x<span class="pl-pds">"</span></span>] <span class="pl-c1">forState:</span>UIControlStateNormal];
btn.frame = CGRectMake(<span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-c1">300</span>, <span class="pl-c1">150</span>);
btn.center = self.view.center;
btn.backgroundColor = [UIColor <span class="pl-c1">greenColor</span>];
[<span class="pl-v">self</span>.view <span class="pl-c1">addSubview:</span>btn];</pre></div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/whde/WhdeButtonLoad">Whdebuttonload</a> is maintained by <a href="https://github.com/whde">whde</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
